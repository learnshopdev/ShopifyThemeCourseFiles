{{ 'main-collection.css' | asset_url | stylesheet_tag }}

<!-- Hero / Controls -->
<header class="page-hero py-4 border-bottom">
  <div class="container">
    <div class="d-flex flex-wrap align-items-end justify-content-between gap-3">
      <div>
        <h1 class="brand fw-black m-0">{{ collection.title }}</h1>
        <small class="text-secondary"><span id="resultcount">{{ collection.products_count }}</span> results</small>
      </div>

      {% assign current_sort = collection.sort_by | default: collection.default_sort_by %}
      <div class="d-flex flex-wrap gap-2">
        <div class="input-group" style="min-width: 220px">
          <span class="input-group-text bg-white"><i class="bi bi-sort-down"></i></span>
          <form method="get" class="flex-grow-1 m-0">
            <select name="sort_by" id="sort" class="form-select" onchange="this.form.submit()">
              <option value="best-selling" {% if current_sort == 'best-selling' %}selected{% endif %}>Best Selling</option>
              <option value="title-ascending" {% if current_sort == 'title-ascending' %}selected{% endif %}>A-Z</option>
              <option value="title-descending" {% if current_sort == 'title-descending' %}selected{% endif %}>Z-A</option>
              <option value="price-ascending" {% if current_sort == 'price-ascending' %}selected{% endif %}>Price: Low to High</option>
              <option value="price-descending" {% if current_sort == 'price-descending' %}selected{% endif %}>Price: High to Low</option>
              <option value="created-ascending" {% if current_sort == 'created-ascending' %}selected{% endif %}>Newest</option>
              <option value="created-descending" {% if current_sort == 'created-descending' %}selected{% endif %}>Oldest</option>
            </select>
          </form>
        </div>
      </div>
    </div>
  </div>
</header>

<main class="py-4">
  <div class="container">
    <div class="row g-4">
      <aside class="col-lg-3">
        <div class="offcanvas-lg offcanvas-start" tabindex="-1" id="filters" aria-labelledby="filtersLabel">
          <div class="offcanvas-header">
            <h5 id="filtersLabel" class="brand fw-black m-0">Filters</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body p-0 p-lg-0">
            <div class="filter-card p-3 p-md-4 sticky-side">

              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="m-0">Categories</h6>
                <a class="btn btn-sm btn-link" href="{{ routes.all_products_collection_url }}">Clear all</a>
              </div>

              <div class="vstack gap-2 mb-3" id="catWrap">
                {% for b in section.blocks %}
                  {% if b.type == 'category' and b.settings.collection %}
                    {% assign col = b.settings.collection %}
                    <div class="form-check m-0">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="cat_{{ col.handle }}"
                        {% if col.handle == collection.handle %}checked{% endif %}
                        onchange="location.href = this.checked ? '{{ col.url }}' : '{{ routes.all_products_collection_url }}'"
                      >
                      <label class="form-check-label" for="cat_{{ col.handle }}">{{ col.title }}</label>
                    </div>
                  {% endif %}
                {% endfor %}
              </div>

              <h6 class="mt-2">Tags</h6>
              <div class="row g-2 mb-3" id="dietWrap">
                {% for b in section.blocks %}
                  {% if b.type == 'product_tag' %}
                    {% assign tag = b.settings.tag %}
                    {% assign is_active = false %}
                    {% for t in current_tags %}
                      {% if t == tag %}
                        {% assign is_active = true %}
                        {% break %}
                      {% endif %}
                    {% endfor %}

                    {% capture add_link %}{{ collection | link_to_add_tag: tag }}{% endcapture %}
                    {% assign add_href = add_link | split: 'href="' | last | split: '"' | first %}

                    {% capture remove_link %}{{ collection | link_to_remove_tag: tag }}{% endcapture %}
                    {% assign remove_href = remove_link | split: 'href="' | last | split: '"' | first %}

                    {% if is_active %}
                      {% assign dest = remove_href %}
                    {% else %}
                      {% assign dest = add_href %}
                    {% endif %}

                    <div class="col-12">
                      <div class="form-check form-switch">
                        <input
                          class="form-check-input diet"
                          type="checkbox"
                          id="tag_{{ tag | handleize }}"
                          {% if is_active %}checked{% endif %}
                          onchange="location.href='{{ dest }}'"
                        />
                        <label class="form-check-label" for="tag_{{ tag | handleize }}">
                          {{ b.settings.label }}
                        </label>
                      </div>
                    </div>
                  {% endif %}
                {% endfor %}
              </div>

              <h6 class="mt-2">Price</h6>
              {%- assign price_filter = nil -%}
              {%- for f in collection.filters -%}
                {%- if f.type == 'price_range' -%}{% assign price_filter = f %}{% break %}{% endif -%}
              {%- endfor -%}

              <form
                method="get"
                class="row g-2 align-items-center mb-3"
                oninput="var f=this; clearTimeout(f._t); f._t=setTimeout(function(){ if(f.requestSubmit) f.requestSubmit(); else f.submit(); }, 450)"
              >
                {%- assign current_sort = collection.sort_by | default: collection.default_sort_by -%}
                {%- if current_sort -%}
                  <input type="hidden" name="sort_by" value="{{ current_sort }}">
                {%- endif -%}

                <div class="col">
                  <input
                    id="minPrice"
                    class="form-control"
                    type="number"
                    min="0"
                    step="1"
                    name="{{ price_filter.min_value.param_name }}"
                    placeholder="Min"
                    {%- if price_filter and price_filter.min_value.value -%}
                      value="{{ price_filter.min_value.value | divided_by: 100 }}"
                    {%- endif -%}
                  />
                </div>

                <div class="col-auto">â€”</div>

                <div class="col">
                  <input
                    id="maxPrice"
                    class="form-control"
                    type="number"
                    min="0"
                    step="1"
                    name="{{ price_filter.max_value.param_name }}"
                    placeholder="Max"
                    {%- if price_filter and price_filter.max_value.value -%}
                      value="{{ price_filter.max_value.value | divided_by: 100}}"
                    {%- endif -%}
                  />
                </div>
              </form>
              
            </div>
          </div>
        </div>
      </aside>

      <!-- Results -->
      <section class="col-lg-9">
        <div id="grid" class="row g-4">
          {% for product in collection.products %}
            <div class="col-12 col-sm-6 col-lg-4">
              <div class="card card-product h-100 position-relative ">
                <button class="btn btn-sm btn-light rounded-circle wishlist position-absolute z-2" style="top:10px; right:10px" title="Save">
                  <i class="bi bi-heart"></i>
                </button>
                <div class="row g-0 ">
                  <div class="col-12">
                    <a class="d-block" href="{{ product.url }}">
                      {% if product.featured_image %}
                        <img
                          src="{{ product.featured_image | image_url: width: 800, height: 540, crop: 'center' }}"
                          class="thumb w-100"
                          alt="{{ product.title | escape }}"
                        >
                      {% endif %}
                    </a>
                  </div>
                  <div class="">
                    <div class="card-body d-flex flex-column h-100 position-relative">
                      <div class="d-flex justify-content-between align-items-start">
                        <h5 class="card-title m-0">
                          <a class="link-dark text-decoration-none" href="{{ product.url }}">{{ product.title }}</a>
                        </h5>
                        <div class="ms-2 fw-semibold">{{ product.price | money }}</div>
                      </div>
                      <div class="small text-secondary">{{ product.description | strip_html | truncate: 50 }}</div>
                      <div class="mt-2">
                        {% assign t = product.tags | join: ',' | downcase %}
                        {% if t contains 'gluten-free' %}<span class="badge text-bg-success text-white me-1">Gluten-Free</span>{% endif %}
                        {% if t contains 'kid-favorite' %}<span class="badge text-bg-pink text-white me-1">Kid Favorite</span>{% endif %}
                        {% if t contains 'limited' %}<span class="badge text-bg-danger text-white me-1">Limited</span>{% endif %}
                        {% if t contains 'filled' %}<span class="badge text-bg-purple text-white me-1">Filled</span>{% endif %}
                        {% if t contains 'nut-free' %}<span class="badge text-bg-info text-dark me-1">Nut-free</span>{% endif %}
                      </div>
                      <!-- This link makes the entire card click through -->
                      <a class="stretched-link" href="{{ product.url }}" aria-label="{{ product.title }}"></a>
                      <div class="d-flex gap-3 align-items-center pt-2 position-relative z-2">
                        <form method="post" action="{{ routes.cart_add_url }}">
                          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                          <input type="hidden" name="quantity" value="1">
                          <button
                            type="submit"
                            class="btn btn-dark w-100 mt-3 btn-sm add"
                            data-name="{{ product.title | escape }}"
                            data-price="{{ product.price | divided_by: 100.0 }}"
                            data-description="{{ product.description | strip_html | escape | truncate: 160 }}"
                            data-img="{{ product.featured_image | img_url: '800x520' }}"
                          >
                            <i class="bi bi-bag-plus"></i> Add
                          </button>
                        </form>
                        <a class="btn btn-outline-dark btn-sm" href="{{ product.url }}">
                          <i class="bi bi-eye"></i> View
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </section>
    </div>
  </div>
</main>


{% schema %}
{
  "blocks": [
    {
      "type": "category",
      "name": "Category",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    },
    {
      "type": "product_tag",
      "name": "Product tag",
      "settings": [
        {
          "type": "text",
          "id": "tag",
          "label": "Product tag (exact)",
          "info": "Matches product tag (case-insensitive). Example: vegan, gf, nutfree"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Label (optional)",
          "info": "Shown next to the switch. Defaults to the tag."
        }
      ]
    }
  ]
}
{% endschema %}
