<!-- PRODUCT GRID -->
<section id="shop" class="py-5">
  <div class="container">
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-3">
      <h2 class="brand fw-black m-0">{{ section.settings.section_title }}</h2>
      <a class="link-dark" href="{{ section.settings.see_all_link }}">
        {{ section.settings.see_all_text }} <i class="bi bi-arrow-right-short"></i>
      </a>
    </div>

    {% assign coll = section.settings.collection %}

    <div class="row g-4" id="grid">
      {% if coll %}
        {% for product in coll.products %}
          <div class="col-12 col-sm-6 col-lg-4 col-xl-3 product">
            <div class="card card-product h-100">
              <a class="d-block" href="{{ product.url }}">
                <img
                  class="thumb w-100"
                  src="{{ product.featured_image | img_url: '800x520' }}"
                  alt="{{ product.title | escape }}"
                />
              </a>
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ product.title }}</h5>
                <p class="card-text small text-secondary">
                  {{ product.description | strip_html | truncate: 100 }}
                </p>
                <div class="d-flex justify-content-between align-items-center mt-auto">
                  <span class="badge text-bg-light pill">
                    {{ product.type | default: 'Cupcake' }}
                  </span>
                  <strong>{{ product.price | money }}</strong>
                </div>

                <form method="post" action="{{ routes.cart_add_url }}">
                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                  <input type="hidden" name="quantity" value="1">
                  <button
                    type="submit"
                    class="btn btn-dark w-100 mt-3 add"
                    data-name="{{ product.title | escape }}"
                    data-price="{{ product.price | divided_by: 100.0 }}"
                    data-description="{{ product.description | strip_html | escape | truncate: 160 }}"
                    data-img="{{ product.featured_image | img_url: '800x520' }}"
                  >
                    <i class="bi bi-bag-plus"></i> {{ section.settings.add_button_text }}
                  </button>
                </form>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="col-12">
          <div class="alert alert-warning mb-0">
            Select a collection in the section settings to show products.
          </div>
        </div>
      {% endif %}
    </div>

    <div class="text-center mt-4">
      <a class="btn btn-outline-dark btn-lg" href="{{ section.settings.build_your_own_link }}">
        <i class="bi bi-box2-heart"></i> {{ section.settings.build_your_own_text }}
      </a>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Homepage Product Grid",
  "settings": [
    {
      "id": "section_title",
      "type": "text",
      "label": "Section Title",
      "default": "This weekâ€™s favorites"
    },
    {
      "id": "see_all_text",
      "type": "text",
      "label": "See All Button Text",
      "default": "See all"
    },
    {
      "id": "see_all_link",
      "type": "url",
      "label": "See All Button URL",
      "default": "/collections/all"
    },

    /* Choose collection (no handle required) */
    {
      "id": "collection",
      "type": "collection",
      "label": "Collection"
    },

    /* Button texts/links */
    {
      "id": "add_button_text",
      "type": "text",
      "label": "Add Button Text",
      "default": "Add"
    },
    {
      "id": "build_your_own_text",
      "type": "text",
      "label": "Bottom Button Text",
      "default": "Build your own dozen"
    },
    {
      "id": "build_your_own_link",
      "type": "url",
      "label": "Bottom Button URL",
      "default": "/collections"
    }
  ]
}
{% endschema %}