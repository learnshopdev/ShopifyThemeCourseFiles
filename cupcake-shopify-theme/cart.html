<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cupcake Cloud ‚Äî Cart</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Grandstander:wght@500;700;900&family=Inter:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --grape: #7e57c2;
        --bubble: #f48fb1;
        --mint: #2dd4bf;
        --lemon: #fcd34d;
        --sky: #60a5fa;
        --ink: #0f172a;
        --cream: #fffaf6;
      }
      body {
        background: linear-gradient(180deg, #fff 0%, #fff5fb 35%, #f0fbff 100%);
        color: var(--ink);
        font-family:
          Inter,
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Helvetica,
          Arial,
          sans-serif;
      }
      .brand {
        font-family: Grandstander, system-ui, sans-serif;
      }
      .navbar {
        backdrop-filter: saturate(130%) blur(6px);
      }
      .nav-link {
        position: relative;
      }
      .nav-link:after {
        content: "";
        position: absolute;
        left: 0.6rem;
        right: 0.6rem;
        bottom: 0.25rem;
        height: 3px;
        background: linear-gradient(90deg, var(--bubble), var(--mint));
        border-radius: 99px;
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.25s ease;
      }
      .nav-link:hover:after,
      .nav-link.active:after {
        transform: scaleX(1);
      }

      .promo {
        background: linear-gradient(
          90deg,
          var(--bubble),
          var(--sky),
          var(--mint)
        );
        color: #0b2a2d;
      }

      .cart-card {
        border: 0;
        border-radius: 18px;
        background: #fff;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
      }
      .line-item + .line-item {
        border-top: 1px solid rgba(15, 23, 42, 0.08);
      }
      .qty .btn {
        width: 38px;
      }
      .thumb {
        width: 96px;
        height: 96px;
        object-fit: cover;
        border-radius: 12px;
      }
      .pill {
        border-radius: 999px;
        font-weight: 600;
      }

      .summary-card {
        position: sticky;
        top: 88px;
      }
      .freebar {
        height: 8px;
        background: #eef2ff;
        border-radius: 999px;
        overflow: hidden;
      }
      .freebar > div {
        height: 100%;
        background: linear-gradient(90deg, var(--lemon), var(--mint));
      }

      .footer {
        background: #0b1220;
        color: #cbd5e1;
      }
      .footer a {
        color: #fbcfe8;
        text-decoration: none;
      }
      .footer a:hover {
        text-decoration: underline;
      }

      @media (max-width: 991.98px) {
        .thumb {
          width: 82px;
          height: 82px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Promo -->
    <div class="promo py-2 text-center small">
      <div class="container">
        <i class="bi bi-ticket-perforated"></i> Use code
        <strong>SWEET10</strong> for 10% off ‚Äî today only!
      </div>
    </div>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg bg-white sticky-top border-bottom py-3">
      <div class="container">
        <a class="navbar-brand brand d-flex align-items-center" href="#">
          <span class="me-2" aria-hidden="true">
            <svg
              width="30"
              height="30"
              viewBox="0 0 64 64"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle cx="32" cy="20" r="10" fill="url(#g1)" />
              <path
                d="M10 34h44l-6 18a4 4 0 0 1-3.8 2.7H19.8A4 4 0 0 1 16 52l-6-18Z"
                fill="url(#g2)"
              />
              <defs>
                <linearGradient
                  id="g1"
                  x1="22"
                  y1="10"
                  x2="42"
                  y2="30"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="#F48FB1" />
                  <stop offset="1" stop-color="#60A5FA" />
                </linearGradient>
                <linearGradient
                  id="g2"
                  x1="10"
                  y1="34"
                  x2="54"
                  y2="52"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="#FCD34D" />
                  <stop offset="1" stop-color="#2DD4BF" />
                </linearGradient>
              </defs>
            </svg>
          </span>
          <span class="fs-3">Cupcake Cloud</span>
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#nav"
          aria-controls="nav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="nav">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="collections.html">Collections</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="all-products.html">Shop</a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#flavorModal"
              >
                Flavor of the Week
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="contact.html">Contact</a>
            </li>
          </ul>
          <div class="d-flex ms-lg-3 gap-2 align-items-center">
            <!-- Auth: Sign in button (shown when logged out) -->
            <button
              class="btn btn-outline-secondary"
              id="btnSignIn"
              data-bs-toggle="modal"
              data-bs-target="#authModal"
            >
              <i class="bi bi-person"></i> Sign in
            </button>

            <!-- Auth: Register button (shown when logged out) -->
            <a class="btn btn-dark" id="btnRegister" href="register.html">
              <i class="bi bi-person-plus"></i> Register
            </a>

            <!-- Auth: user dropdown (shown when logged in) -->
            <div class="dropdown d-none" id="userMenu">
              <button
                class="btn btn-outline-secondary dropdown-toggle"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi bi-person-circle"></i>
                <span id="navUserName">Account</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <a class="dropdown-item" href="account.html"
                    ><i class="bi bi-person"></i> Account</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="orders.html"
                    ><i class="bi bi-receipt"></i> Orders</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <button class="dropdown-item text-danger" id="btnLogout">
                    <i class="bi bi-box-arrow-right"></i>
                    Log out
                  </button>
                </li>
              </ul>
            </div>

            <!-- Existing cart / order buttons -->
            <a class="btn btn-outline-dark" href="cart.html">
              <i class="bi bi-bag"></i> Cart
              <span class="badge text-bg-danger ms-1" id="cartCount">0</span>
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Header -->
    <header class="pt-4 pb-2">
      <div class="container">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb small mb-2">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">Cart</li>
          </ol>
        </nav>
        <div
          class="d-flex justify-content-between align-items-end flex-wrap gap-2"
        >
          <div>
            <h1 class="brand fw-black m-0">Your cart</h1>
            <p class="text-secondary mb-0">
              <span id="itemCount">0</span> items
            </p>
          </div>
        </div>
      </div>
    </header>

    <main class="pb-5">
      <div class="container">
        <div class="row g-4">
          <!-- Left: items -->
          <div class="col-lg-8">
            <div class="cart-card p-3 p-md-4">
              <div id="emptyState" class="text-center py-5 d-none">
                <div class="display-6">üßÅ</div>
                <h5 class="brand fw-black">Your cart is empty</h5>
                <p class="text-secondary">
                  Let‚Äôs fix that. Explore favorites and limited drops.
                </p>
                <a class="btn btn-dark" href="/collection-all.html"
                  ><i class="bi bi-bag-heart me-1"></i> Start shopping</a
                >
              </div>

              <div id="itemList" class="vstack gap-3"></div>
            </div>
          </div>

          <!-- Right: summary -->
          <div class="col-lg-4">
            <div class="cart-card p-3 p-md-4 summary-card">
              <h6 class="mb-3">Order summary</h6>
              <div
                class="freebar mb-3"
                aria-label="progress toward free shipping"
                role="progressbar"
                aria-valuemin="0"
                aria-valuemax="35"
                aria-valuenow="0"
              >
                <div id="freeFill" style="width: 0%"></div>
              </div>

              <div class="d-flex justify-content-between mb-1 small">
                <span>Subtotal</span><span id="sumSubtotal">$0.00</span>
              </div>
              <div class="d-flex justify-content-between mb-1 small">
                <span>Discounts</span><span id="sumDiscounts">-$0.00</span>
              </div>
              <div class="d-flex justify-content-between mb-1 small">
                <span>Tax (est.)</span><span id="sumTax">$0.00</span>
              </div>
              <hr />
              <div class="d-flex justify-content-between fs-5 fw-semibold">
                <span>Total</span><span id="sumTotal">$0.00</span>
              </div>
              <div class="form-check mt-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="agree"
                  checked
                />
                <label class="form-check-label small" for="agree"
                  >I agree to the <a href="#">Terms</a> and
                  <a href="#">Privacy</a>.</label
                >
              </div>
              <div class="d-grid gap-2 mt-3">
                <button class="btn btn-dark btn-lg" id="checkout">
                  <i class="bi bi-credit-card"></i> Checkout
                </button>
                <a class="btn btn-outline-dark" href="/collection-all.html"
                  ><i class="bi bi-arrow-left"></i> Continue shopping</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer pt-5 pb-4 mt-5">
      <div class="container">
        <div class="row g-4">
          <div class="col-md-4">
            <div class="brand fs-3 mb-2">Cupcake Cloud</div>
            <p class="text-light">
              Small‚Äëbatch bakery crafting colorful cupcakes since 2012.
            </p>
            <div class="d-flex gap-3">
              <a href="#" aria-label="Instagram"
                ><i class="bi bi-instagram fs-4"></i
              ></a>
              <a href="#" aria-label="TikTok"
                ><i class="bi bi-tiktok fs-4"></i
              ></a>
              <a href="#" aria-label="Facebook"
                ><i class="bi bi-facebook fs-4"></i
              ></a>
            </div>
          </div>
          <div class="col-6 col-md-2">
            <h6 class="text-uppercase text-secondary">Shop</h6>
            <ul class="list-unstyled small">
              <li>
                <a href="all-products.html">All Cupcakes</a>
              </li>
              <li><a href="collections.html">Collections</a></li>
            </ul>
          </div>
          <div class="col-6 col-md-2">
            <h6 class="text-uppercase text-secondary">Help</h6>
            <ul class="list-unstyled small">
              <li><a href="faq.html">FAQ</a></li>
              <li><a href="contact.html">Contact</a></li>
            </ul>
          </div>
          <div class="col-md-4">
            <h6 class="text-uppercase text-secondary">Guarantee</h6>
            <p class="small">
              If you don‚Äôt love it, we‚Äôll make it right. That‚Äôs our
              Sprinkle‚ÄëHappy Guarantee.
            </p>
          </div>
        </div>
        <hr class="border-secondary border-opacity-25 my-4" />
        <div
          class="d-flex flex-wrap justify-content-between small text-secondary"
        >
          <span>¬© <span id="year"></span> Cupcake Cloud</span>
          <div class="d-flex gap-3">
            <a href="privacy.html">Privacy</a>
            <a href="terms.html">Terms</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- FLAVOR OF THE WEEK MODAL -->
    <div
      class="modal fade"
      id="flavorModal"
      tabindex="-1"
      aria-labelledby="flavorModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 id="flavorModalLabel" class="modal-title brand fw-black">
              Flavor of the Week
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <div class="modal-body">
            <div class="row g-4 align-items-center">
              <div class="col-lg-6">
                <img
                  class="img-fluid rounded-4 shadow"
                  src="https://placehold.co/900x560/fef3c7/0b1220?text=Flavor+of+the+Week:+Mango+Sunrise"
                  alt="Flavor of the Week"
                />
              </div>
              <div class="col-lg-6">
                <h2 class="brand fw-black">
                  Flavor of the Week: Mango Sunrise
                </h2>
                <p>
                  Vanilla-mango marble cake with passionfruit curd and mango
                  buttercream. Tropical sunshine in a bite.
                </p>

                <div class="d-flex align-items-center gap-3 mb-3">
                  <span class="badge text-bg-warning">Limited</span>
                  <span class="badge text-bg-info">Tropical</span>
                </div>

                <div class="p-3 border rounded-4 bg-white">
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <strong>Ends in</strong>
                    <div class="countdown h5 m-0" id="countdown">
                      03d 00h 00m 00s
                    </div>
                  </div>
                </div>

                <div class="d-flex gap-3 mt-3">
                  <button
                    class="btn btn-dark add"
                    data-name="Mango Sunrise (FOTW)"
                    data-price="4.50"
                  >
                    <i class="bi bi-bag-plus"></i> Add to cart
                  </button>
                  <button
                    class="btn btn-outline-dark"
                    data-bs-dismiss="modal"
                    onclick="scrollToShop()"
                  >
                    <i class="bi bi-bag"></i> See all flavors
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <small class="text-secondary"
              >Limited-time drop ‚Äî available while supplies last.</small
            >
          </div>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div
      class="position-fixed bottom-0 start-50 translate-middle-x p-3"
      style="z-index: 1080"
    >
      <div
        id="liveToast"
        class="toast align-items-center text-white bg-dark border-0"
        role="status"
        aria-live="polite"
        aria-atomic="true"
      >
        <div class="d-flex">
          <div class="toast-body" id="toastMsg">Cart updated</div>
          <button
            type="button"
            class="btn-close btn-close-white me-2 m-auto"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // --- Utilities ---
      document.getElementById("year").textContent = new Date().getFullYear();
      let t;
      function toast(msg) {
        const el = document.getElementById("liveToast");
        document.getElementById("toastMsg").textContent = msg;
        (t || (t = new bootstrap.Toast(el, { delay: 1800 }))).show();
      }
      const fmt = (n) => `$${(Math.round(n * 100) / 100).toFixed(2)}`;

      // --- Cart State ---
      const STORAGE_KEY = "cupcakeCart";
      const FREE_SHIP_THRESHOLD = 35; // dollars
      const TAX_RATE = 0.0825; // est.

      let cart = [];
      let promos = []; // {code, label, amount, type}

      function loadCart() {
        try {
          // Prefer existing global cart if present
          if (window.cupcakeCart && Array.isArray(window.cupcakeCart)) {
            cart = JSON.parse(JSON.stringify(window.cupcakeCart));
          } else {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (raw) {
              cart = JSON.parse(raw);
            }
          }
        } catch (e) {
          cart = [];
        }
        if (!cart || !cart.length) {
          // Seed demo items
          cart = [
            {
              id: "van",
              name: "Vanilla Confetti",
              price: 3.5,
              qty: 2,
              img: "https://placehold.co/600x400/ffd1e7/0b1220?text=Vanilla+Confetti",
              tags: ["Classic"],
            },
            {
              id: "mocha",
              name: "Mocha Latte Buzz",
              price: 3.95,
              qty: 1,
              img: "https://placehold.co/600x400/ded3ff/0b1220?text=Mocha+Latte+Buzz",
              tags: ["Chocolate"],
            },
            {
              id: "mango",
              name: "Mango Sunrise",
              price: 4.15,
              qty: 1,
              img: "https://placehold.co/600x400/ffd9a8/0b1220?text=Mango+Sunrise",
              tags: ["Fruity"],
            },
          ];
        }
      }
      function saveCart() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(cart));
      }

      // --- Rendering ---
      const itemList = document.getElementById("itemList");
      const emptyState = document.getElementById("emptyState");
      const itemCount = document.getElementById("itemCount");
      const sumSubtotal = document.getElementById("sumSubtotal");
      const sumDiscounts = document.getElementById("sumDiscounts");
      const sumShipping = document.getElementById("sumShipping");
      const sumTax = document.getElementById("sumTax");
      const sumTotal = document.getElementById("sumTotal");
      const freeFill = document.getElementById("freeFill");
      const freeGap = document.getElementById("freeGap");

      function render() {
        // Items
        itemList.innerHTML = "";
        cart.forEach((it, idx) => {
          const row = document.createElement("div");
          row.className = "line-item d-flex gap-3 align-items-start";
          row.innerHTML = `
          <img src="${it.img}" alt="${it.name}" class="thumb">
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <div class="fw-semibold">${it.name}</div>
                ${(it.tags || []).map((tag) => `<span class='badge text-bg-light pill me-1'>${tag}</span>`).join("")}
              </div>
              <button class="btn btn-sm btn-outline-danger" aria-label="Remove ${it.name}"><i class="bi bi-x"></i></button>
            </div>
            <div class="d-flex flex-wrap align-items-center gap-3 mt-2">
              <div class="input-group qty" style="width:140px">
                <button class="btn btn-outline-secondary" aria-label="Decrease quantity"><i class="bi bi-dash"></i></button>
                <input type="number" class="form-control text-center" min="1" value="${it.qty}">
                <button class="btn btn-outline-secondary" aria-label="Increase quantity"><i class="bi bi-plus"></i></button>
              </div>
              <div class="ms-auto fw-semibold">${fmt(it.price * it.qty)}</div>
            </div>
          </div>
        `;
          // Handlers
          const [btnMinus, inputQty, btnPlus] =
            row.querySelectorAll(".qty > *");
          btnMinus.addEventListener("click", () => changeQty(idx, -1));
          btnPlus.addEventListener("click", () => changeQty(idx, +1));
          inputQty.addEventListener("change", () =>
            setQty(idx, parseInt(inputQty.value || "1", 10)),
          );
          row
            .querySelector(".btn-outline-danger")
            .addEventListener("click", () => removeItem(idx));
          itemList.appendChild(row);
        });

        itemCount.textContent = cart.reduce((a, c) => a + c.qty, 0);
        updateSummary();
      }

      function changeQty(i, d) {
        cart[i].qty = Math.max(1, (cart[i].qty || 1) + d);
        saveCart();
        render();
        toast("Cart updated");
      }
      function setQty(i, q) {
        q = Math.max(1, q || 1);
        cart[i].qty = q;
        saveCart();
        render();
        toast("Cart updated");
      }
      function removeItem(i) {
        const name = cart[i].name;
        cart.splice(i, 1);
        saveCart();
        render();
        toast(`${name} removed`);
      }

      function computeDiscount(subtotal) {
        let discount = 0;
        const upromos = promos.slice();
        upromos.forEach((p) => {
          if (p.kind === "percent") discount += subtotal * (p.value / 100);
          if (p.kind === "percent_threshold" && subtotal >= (p.min || 0))
            discount += subtotal * (p.value / 100);
          if (p.kind === "fourthfree") {
            // Approx: every 4th cheapest item free (1 qty each block of 4)
            const copies = [];
            cart.forEach((i) => {
              for (let k = 0; k < i.qty; k++) copies.push(i.price);
            });
            copies.sort((a, b) => a - b);
            for (let idx = 3; idx < copies.length; idx += 4)
              discount += copies[idx];
          }
        });
        return discount;
      }

      function updateSummary() {
        const subtotal = cart.reduce((a, c) => a + c.price * c.qty, 0);
        const discount = computeDiscount(subtotal);

        // Tax is estimated on (subtotal - discount)
        const taxable = Math.max(0, subtotal - discount);
        const tax = taxable * TAX_RATE;
        const total = taxable + tax;

        sumSubtotal.textContent = fmt(subtotal);
        sumDiscounts.textContent = "-" + fmt(discount);
        sumTax.textContent = fmt(tax);
        sumTotal.textContent = fmt(total);

        saveCart();
      }

      // Checkout (demo)
      document.getElementById("checkout").addEventListener("click", () => {
        if (!document.getElementById("agree").checked) {
          toast("Please agree to Terms & Privacy");
          return;
        }
        if (!cart.length) {
          toast("Cart is empty");
          return;
        }
        const note = document.getElementById("giftNote").value.trim();
        console.log("Checking out with", { cart, promos, note });
        toast("Checkout is a mock in this template");
      });

      // Init
      loadCart();
      render();
    </script>
  </body>
</html>
